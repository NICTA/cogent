How To Use The Cogent Compiler
==============================

Command-line Arguments
------------------------------------

The Cogent compiler accepts
a large number of command-line arguments,
which are either *commands*,
directing the compiler to produce particular outputs,
or *flags*,
influencing the compiler's behaviour as it works.

.. comment:

   In typical use,
   only a small number of the commands and flags are used,
   the most common of which
   (and those listed by ``--help`` by default) are:

   --parse  \
       parse Cogent source code
   -t, --typecheck  \
       typecheck surface program
   -d, --desugar  \
       desugar surface program and re-type it
   --normal  \
       normalise core language and re-type it
   --mono  \
       monomorphise core language and re-type it
   -g, --code-gen  \
       generate C code
   --build-info  \
       log how cogent is being invoked by generating BUILD_INFO file;
       implied by any collective commands
   -C, --c-refinement  \
       [COLLECTIVE] generate all files needed for the C refinement proof
   -F, --functional-correctness  \
       [COLLECTIVE] generate all files needed for the functional correctness proof
   -A, --all  \
       [COLLECTIVE] generate everything
   --stdgum-dir  \
       display directory where standard gum headers are installed
       (can be set by COGENT_STD_GUM_DIR environment variable)
   -h, --help  \
       display help message;
       optionally including a verbosity from 0 to 4, defaulting to 1
   -v, -V, --version  \
       show the Cogent compiler's version number

   -O LEVEL, --optimisation=LEVEL  \
       set optimisation level (0, 1, 2, d, n, s or u; default -Od)


Commands
^^^^^^^^^^^^^^^^^^^^^^^^

--ast-c  \
    parse C file with Cogent antiquotation and print AST
--stack-usage=FILE  \
    parse stack usage .su file generated by gcc; FILE optional
--parse  \
    parse Cogent source code
-t, --typecheck  \
    typecheck surface program
-d, --desugar  \
    desugar surface program and re-type it
--normal  \
    normalise core language and re-type it
--simplify  \
    simplify core language and re-type it
--mono  \
    monomorphise core language and re-type it
-g, --code-gen  \
    generate C code
--ast-parse  \
    display surface language AST
--ast-tc  \
    display type-checked surface language AST
--ast-desugar  \
    display desugared core language AST
--ast-normal  \
    display normalised core language AST
--ast-simpl  \
    display simplified core language AST
--ast-mono  \
    display monomorphised core language AST
-i, --repl  \
    run Cogent REPL
--docgent  \
    generate HTML documentation
    (must be enabled at Cogent compile time)
--pretty-parse  \
    pretty-print surface language
-T, --pretty-tc  \
    pretty-print type-checked surface language
-D, --pretty-desugar  \
    pretty-print desugared core language
--pretty-normal  \
    pretty-print normalised core language
--pretty-simpl  \
    pretty-print simplified core language
--pretty-mono  \
    pretty-print monomorphised core language
--hs-shallow-desugar  \
    generate Haskell shallow embedding (desugared core)
--hs-shallow-desugar-tuples  \
    generate Haskell shallow embedding (desugared core, with Haskell Tuples)
--hs-ffi  \
    generate Haskell FFI code to access generated C code
    (including a ``.hsc`` module for types
    and a ``.hs`` module for functions)
--deep-desugar  \
    generate Isabelle deep embedding (desugared core)
--deep-normal  \
    generate Isabelle deep embedding (normalised core)
--deep-mono  \
    generate Isabelle deep embedding (monomorphised core)
--shallow-desugar  \
    generate Isabelle shallow embedding (desugared core)
--shallow-normal  \
    generate Isabelle shallow embedding (normalised core)
--shallow-mono  \
    generate Isabelle shallow embedding (monomorphised core)
--shallow-desugar-tuples  \
    enerate Isabelle shallow embedding (desugared core, with HOL tuples)
--scorres-desugar  \
    generate scorres (desugared core)
--scorres-normal  \
    generate scorres (normalised core)
--scorres-mono  \
    generate scorres (monomorphised core)
--shallow-consts-desugar  \
    generate constant definitions for shallow embedding (desugared core)
--shallow-consts-normal  \
    generate constant definitions for shallow embedding (normalised core)
--shallow-consts-mono  \
    generate constant definitions for shallow embedding (monomorphised core)
--shallow-consts-desugar-tuples  \
    generate constant definitions for shallow embedding (desugared core, with HOL tuples)
--shallow-tuples-proof  \
    generate proof for shallow tuples embedding
--normal-proof  \
    generate Isabelle proof of normalisation
--mono-proof  \
    generate monomorphisation proof
--ac-install  \
    generate an Isabelle theory to install AutoCorres
--corres-setup  \
    generate Isabelle lemmas for c-refinement
--corres-proof  \
    generate Isabelle proof of c-refinement
--type-proof-normal  \
    generate Isabelle proof of type correctness of normalised AST
--type-proof  \
    generate Isabelle proof of type correctness of normal-mono AST
--all-refine  \
    [COLLECTIVE] generate shallow-to-C refinement proof
--root  \
    generate an Isabelle ROOT file
--table-c-types  \
    generate a table of Cogent and C type correspondence
--table-shallow  \
    generate a table of type synonyms for shallow embedding
--table-abs-func-mono  \
    generate a table of monomorphised abstract functions
--table-abs-type-mono  \
    generate a table of monomorphised abstract types
-G, --graph-gen  \
    generate graph for graph-refine
--build-info  \
    log how cogent is being invoked by generating BUILD_INFO file;
    implied by any collective commands
-C, --c-refinement  \
    [COLLECTIVE] generate all files needed for the C refinement proof
-F, --functional-correctness  \
    [COLLECTIVE] generate all files needed for the functional correctness proof
-A, --all  \
    [COLLECTIVE] generate everything
-Q, --quickcheck  \
    [COLLECTIVE] generate QuickCheck related artifacts
--stdgum-dir  \
    display directory where standard gum headers are installed
    (can be set by the ``$COGENT_STD_GUM_DIR`` environment variable)
-v, -V, --version  \
    show version number


All Flags
^^^^^^^^^^^^^^^^^^^^^^^^

-o NAME, --output-name=NAME  \
    specify base name for output files (default is derived from source Cogent file)
--proof-name=NAME  \
    specify Isabelle theory file name (default is derived from source Cogent file)
--abs-type-dir=PATH  \
    abstract type definitions will be in $DIR/abstract/, which must exist (default=./)
--dist-dir=PATH  \
    specify path to all output files (default=./)
--fake-header-dir=PATH  \
    specify path to fake c header files
--root-dir=PATH  \
    specify path to top-level directory (for imports in theory files only, default=./)
--cust-ty-gen=FILE  \
    config file to customise type generation
--entry-funcs=FILE  \
    give a list of Cogent functions that are only called from outside
--ext-types=FILE  \
    give external type names to C parser
--infer-c-funcs=FILE  \
    infer Cogent abstract function definitions (can be specified multiple times)
--infer-c-types=FILE  \
    infer Cogent abstract type definitions (can be specified multiple times)
--name-cache=FILE  \
    specify the name cache file to use
--proof-input-c=FILE  \
    specify input C file to generate proofs (default to the same base name as input Cogent file)
--prune-call-graph=FILE  \
    specify Cogent entry-point definitions
--cogent-pp-args=ARG  \
    arguments given to Cogent preprocessor (same as cpphs; can be specified multiple times)
--cpp=PROG  \
    set which C-preprocessor to use (default to cpp)
--cpp-args=ARG  \
    arguments given to C-preprocessor (default to $CPPIN -P -o $CPPOUT)
--ddump-smt  \
    dump verbose SMT-solving information
--ddump-tc  \
    dump (massive) surface typechecking internals
--ddump-tc-ctx  \
    dump surface typechecking with context
--ddump-tc-filter=KEYWORDS  \
    a space-separated list of keywords to indicate which groups of info to display (gen, sol, post, tc)
--ddump-to-file=FILE  \
    dump debugging output to specific file instead of terminal
--ddump-pretty-ds-no-tc  \
    dump the pretty printed desugared expression before typechecking
--fcheck-undefined  \
    (default) check for undefined behaviours in C
-B, --fdisambiguate-pp  \
    when pretty-printing, also display internal representation as comments
--fffi-c-functions  \
    generate FFI functions in the C code (should be used when -Q)
--fflatten-nestings  \
    flatten out nested structs in C code (does nothing)
--ffncall-as-macro  \
    generate macros instead of real function calls
--ffull-src-path  \
    display full path for source file locations
--ffunc-purity-attr  \
    (default) generate GCC attributes to classify purity of Cogent functions
--fgen-header  \
    generate build info header in all output files, reverse of --fno-gen-header
--fintermediate-vars  \
    (default) generate intermediate variables for Cogent expressions
--flax-take-put  \
    allow take/put type operators on abstract datatypes
--flet-in-if  \
    (default) put binding of a let inside an if-clause
--fletbang-in-if  \
    (default) put binding of a let! inside an if-clause
--fml-typing-tree  \
    (default) generate ML typing tree in type proofs
--fnormalisation=NF  \
    (default) normalise the core language (NF=anf, knf, lnf; default is anf)
--fno-check-undefined  \
    reverse of --fcheck-undefined
--fno-flatten-nestings  \
    (default) reverse of --fflatten-nestings
--fno-fncall-as-macro  \
    (default) reverse of --ffncall-as-macro
--fno-func-purity-attr  \
    reverse of --ffunc-purity-attr
--fno-gen-header  \
    (default) don't generate build info header in any output files
--fno-intermediate-vars  \
    reverse of --fintermediate-vars
--fno-lax-take-put  \
    (default) reverse of --flax-take-put
--fno-let-in-if  \
    reverse of --flet-in-if
--fno-letbang-in-if  \
    reverse of --fletbang-in-if
--fno-ml-typing-tree  \
    reverse of --fml-typing-tree
--fno-normalisation  \
    reverse of --fnormalisation
--fno-pragmas  \
    reverse of --fpragmas
--fno-pretty-errmsgs  \
    reverse of --fpretty-errmsgs
--fno-reverse-tc-errors  \
    (default) reverse of --freverse-tc-errors
--fno-share-linear-vars  \
    (default) reverse of --fshare-linear-vars
--fno-show-types-in-pretty  \
    (default) reverse of --fshow-types-in-pretty
--fno-simplifier  \
    (default) reverse of --fsimplifier
--fno-static-inline  \
    reverse of --fstatic-inline
--fno-tc-ctx-constraints  \
    (default) reverse of --ftc-ctx-constraints
--fno-tp-with-bodies  \
    reverse of --ftp-with-bodies
--fno-tp-with-decls  \
    reverse of --ftp-with-decls
--fno-tuples-as-sugar  \
    reverse of --ftuples-as-sugar
--fno-union-for-variants  \
    (default) reverse of --funion-for-variants
--fno-untyped-func-enum  \
    reverse of --funtyped-func-enum
--fno-use-compound-literals  \
    reverse of --fuse-compound-literals, it instead creates new variables
--fno-wrap-put-in-let  \
    (default) reverse of --fwrap-put-in-let
--fpragmas  \
    (default) preprocess pragmas
--fpretty-errmsgs  \
    (default) pretty-print error messages (requires ANSI support)
--freverse-tc-errors  \
    Print type errors in reverse order
--fshare-linear-vars  \
    reuse C variables for linear objects
--fshow-types-in-pretty  \
    show inferred types of each AST node when doing pretty-printing
--fsimplifier  \
    enable simplifier on core language
--fsimplifier-level=NUMBER  \
    number of iterations simplifier does (default=4)
--fstatic-inline  \
    (default) generate static-inlined functions in C
--ftuples-as-sugar  \
    (default) treat tuples as syntactic sugar to unboxed records, which gives better performance
--ftc-ctx-constraints  \
    display constraints in type errors
--ftc-ctx-len=NUMBER  \
    set the depth for printing error context in typechecker (default=3)
--ftp-with-bodies  \
    (default) generate type proof with bodies
--ftp-with-decls  \
    (default) generate type proof with declarations
--funion-for-variants  \
    use union types for variants in C code (cannot be verified)
--funtyped-func-enum  \
    (default) use untyped function enum type
--fuse-compound-literals  \
    (default) use compound literals when possible in C code
--fwrap-put-in-let  \
    Put always appears in a Let-binding when normalised
-O LEVEL, --optimisation=LEVEL  \
    set optimisation level (0, 1, 2, d, n, s or u; default -Od)
--Wall  \
    issue all warnings
-E, --Werror  \
    make any warning into a fatal error
--Wdodgy-take-put  \
    (default) enable warnings on ill-formed take or put in types
--Wdynamic-variant-promotion  \
    enable warnings on dynamic variant type promotion
--Wimplicit-int-lit-promotion  \
    (default) enable warning on implicit integer literal promotion
--Wmono  \
    enable warnings during monomorphisation
--Wunused-local-binds  \
    warn about unused local binders
--Wno-dodgy-take-put  \
    reverse of --Wdodgy-take-put
--Wno-dynamic-variant-promotion  \
    (default) reverse of --Wdynamic-variant-promotion
--Wno-mono  \
    (default) reverse of --Wmono
--Wno-implicit-int-lit-promotion  \
    reverse of --Wimplicit-int-lit-promotion
--Wno-unused-local-binds  \
    (default) reverse of --Wunused-local-binds
-w, --Wno-warn  \
    turn off all warnings
--Wwarn  \
    (default) warnings are treated only as warnings, not as errors
-q, --quiet  \
    do not display compilation progress
-x, --fdump-to-stdout  \
    dump all output to stdout
--interactive  \
    interactive compiler mode
--type-proof-sorry-before=FUN_NAME  \
    bad hack: sorry all type proofs for functions that precede given function name
